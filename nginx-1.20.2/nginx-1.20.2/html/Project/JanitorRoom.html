<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Janitor Room</title>
<link rel="stylesheet" href="styles.css" />
<script src="hittest.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() { 
    $('#content').hide();
    $('#content').fadeIn(3000);
    $('#chatbox').hide();
    $('#box').hide();
    $('#player').hide();
    $('#maze').hide();
    $('#goal').hide();
    $('#arrowDown').hide();
    var counter = 0;
    var clicked = true;
    var Drawing = false;

    if (localStorage.getItem('firstJanitorRoom') == 'true'){

    $("div#stage").click(ClickCommand);

    function ClickCommand(){
        if (clicked){
        counter++;
        }
        if (counter == 1){
            $('#blur').css({ 'opacity': '0.5'});
            $('div#chattext').text("So this was the room...");
            $('#chatbox').show();
        }
        if (counter == 2){
            $('div#chattext').text("I'm suprised things are still intact.");
        }
        if (counter == 3){
            $('#blur').css({ 'opacity': '0'});
            $('#chatbox').hide();
            $('#box').show();
            $('#arrowDown').show();
            localStorage.setItem('firstJanitorRoom', 'false');    
        }
    }
    }
    if (localStorage.getItem('firstJanitorRoom') == 'false'){
            $('#window').show();
        $('#drawing').show();
        $('#arrowDown').show();
        }

        $("div#box").click(function(){
            $('#box').hide();
            $('#arrowDown').hide();
            var counter = 0;
            $('div#stage').click(function(){
                counter++;
                console.log(counter);
                
            if (counter == 1){
                $('#blur').css({ 'opacity': '0.5'});
                $('div#chattext').text("There may be some clues inside this box.");
                $('#chatbox').show();
            }
            if (counter == 2){
                $('div#chattext').text("Lets try lock picking it.");
            }
            if (counter == 3){
                $('div#chattext').text("Lets try lock picking it.");
            }
            if (counter == 4){
                $('div#chattext').text("Use arrow keys to navigate to the goal");
                $('#blur').css({ 'opacity': '1'});
                $('#player').show();
                $('#maze').show();
                $('#goal').show();
            }
            if (counter == 5){
                $('#chatbox').hide();
            }
            
            })
        })
        
        var going;
        var animation;
        var movement = {
            37:{ left: '-=1'},
            38:{ top: '-=1'},
            39:{ right: '-=1'},
            40:{ top: '+=1'},
        }
        $(document).one('keydown', keyDown);

        function keyDown(event){
            $(document).one('keyup',keyUp);
            if(event.keyCode==37||event.keyCode==38||event.keyCode==39||event.keyCode==40){
                animation = movement[event.keyCode];
                going = setInterval(keepGoing,1);
            }
        }
        function keepGoing(){
            $('#player').css(animation);
        }
        function keyUp(){
            clearInterval(going);
            $(document).one('keydown', keyDown);
        }

        function detectCollision(){
        var hit = $('#player').objectHitTest({"object":$('#maze'),"transparency":true});
        console.log(hit);
        if(hit){
            $('#player').hide();
            clearInterval(collisionTimer);
        }
        }

    var collisionTimer = setInterval(detectCollision,50);
        $("#arrowDown").click(function(){
            window.location = 'hallway1.html';
        })
});
</script>
</head>
<body>
<div id ="stage">
    <div id="content">
            <img id="player" src ="player.png">
            <img id="maze" src = "tunnel.png">
            <img id="goal" src = "test.png">

        <img id="arrowDown" src="test.png">
        <div id="box" class="clickables"></div>
    <div id="blur"></div>
    <div id="chatbox"> 
        <div id="chatname">D</div>
        <div id="chattext"></div>
    </div>
</div>
</div>

</body>
</html>